<div class="max-w-2xl mx-auto py-10 px-4">
  
  <div class="flex items-center justify-between mb-8">
    <app-back-button />

    @if (item(); as data) {
      <div class="flex items-center gap-3">
        <app-action-button 
          [itemId]="data.id" 
          [authorId]="data.provider.id" 
          [itemType]="'marketplace'"
          [routePath]="'marketplace'" 
          mode="edit"
        />
      </div>
    }
  </div>

  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-20 gap-4">
      <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
      <p class="text-gray-500 font-medium">Loading item details...</p>
    </div>
  } 
  
  @else if (isError()) {
    <div class="text-center py-20 bg-red-50 rounded-3xl border border-red-100">
      <p class="text-red-600 font-medium">Something went wrong while loading the item.</p>
    </div>
  } 
  
  @else if (item(); as data) {
    <article class="bg-white rounded-3xl p-8 shadow-sm border border-gray-100">
      
      <div class="flex flex-col md:flex-row md:items-start justify-between gap-4 mb-6">
        <div>
          <div class="flex items-center gap-3 mb-3">
            <span
              class="px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full"
              [class.bg-green-100]="data.category === 'offered'"
              [class.text-green-700]="data.category === 'offered'"
              [class.bg-blue-100]="data.category === 'wanted'"
              [class.text-blue-700]="data.category === 'wanted'"
            >
              {{ data.category === 'offered' ? 'Offered' : 'Wanted' }}
            </span>
            <span class="text-gray-500 text-sm font-medium flex items-center gap-1">
              üìç {{ data.location }}
            </span>
          </div>
          <h1 class="text-3xl font-black text-gray-900 leading-tight">{{ data.title }}</h1>
        </div>

        <div class="shrink-0">
           @if (data.price) {
            <span class="text-3xl font-bold text-green-600 block">{{ data.price | currency : 'EUR' }}</span>
           } @else {
            <span class="text-3xl font-bold text-green-600 block">Free</span>
           }
        </div>
      </div>

      <hr class="border-gray-100 mb-8" />

      <p class="text-gray-700 leading-relaxed text-lg whitespace-pre-wrap mb-10">{{ data.description }}</p>

      <div class="flex items-center justify-between pt-6 border-t border-gray-50">
        <div class="flex items-center gap-3">
           <div class="w-12 h-12 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center font-bold text-xl">
             {{ data.provider.username.charAt(0).toUpperCase() }}
           </div>
           <div>
             <p class="text-xs text-gray-400 uppercase font-bold mb-0.5">Sold by</p>
             <a [routerLink]="['/user', data.provider.id]" class="font-bold text-blue-600 hover:underline hover:text-blue-800 transition-colors">
               {{ data.provider.username }}
             </a>
           </div>
        </div>
        
        <p class="text-xs text-gray-400 font-medium">
          Posted {{ data.createdAt | date : 'mediumDate' }}
        </p>
      </div>

    </article>
  } 
  
  @else {
    <div class="text-center py-20 bg-gray-50 rounded-3xl border border-gray-200">
      <p class="text-gray-500 font-medium">Item not found.</p>
    </div>
  }
</div>