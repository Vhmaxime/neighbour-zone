<div class="search-container">
  @if (searchControl.value) {
  <div class="backdrop"></div>
  }

  <input
    [formControl]="searchControl"
    type="text"
    placeholder="Search events or items..."
    class="search-input"
  />

  @if (searchControl.value) {
  <div class="results-dropdown">
    @if (isSearching()) {
    <div class="loading-state">Searching...</div>
    } @else if (searchResults(); as searchResults) { @if (searchResults.users.length > 0) {
    <div>
      <div class="section-header">Users</div>
      @for (user of searchResults.users; track user.id) {
      <div class="result-item" (click)="onSelectUser(user.id)">
        <span class="title">{{ user.username }}</span>
      </div>
      }
    </div>
    } @if (searchResults.posts.length > 0) {
    <div>
      <div class="section-header">Posts</div>
      @for (post of searchResults.posts; track post.id) {
      <div class="result-item" (click)="onSelectPost(post.id)">
        <span class="title">{{ post.title }}</span>
      </div>
      }
    </div>
    } @if (searchResults.events.length > 0) {
    <div>
      <div class="section-header">Events</div>
      @for (event of searchResults.events; track event.id) {
      <div class="result-item" (click)="onSelectEvent(event.id)">
        <span class="title">{{ event.title }}</span>
        <span class="meta">{{ event.dateTime | date : 'short' }}</span>
      </div>
      }
    </div>
    } @if (searchResults.marketplace.length > 0) {
    <div>
      <div class="section-header">Marketplace</div>
      @for (item of searchResults.marketplace ; track item.id) {
      <div class="result-item" (click)="onSelectMarketplace(item.id)">
        <span class="title">{{ item.title }}</span>
        <span class="meta">{{ item.description.slice(0, 30) }}...</span>
      </div>
      }
    </div>
    } @if ( searchResults.users.length === 0 && searchResults.posts.length === 0 &&
    searchResults.events.length === 0 && searchResults.marketplace.length === 0 && !isSearching() )
    {
    <div class="no-results">No matches found.</div>
    } }
  </div>
  }
</div>
