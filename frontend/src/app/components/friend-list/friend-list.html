@if (error()) {
<div class="text-center py-4 bg-red-100 text-red-700 rounded-xl mb-4">
  <p>{{ error() }}</p>
</div>
} @else {
<div class="w-full bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
  <div class="flex flex-col border-b border-gray-100">
    <button
      (click)="setActiveTab('friends')"
      [class]="activeTab() === 'friends' ? 'tab-button active' : 'tab-button'"
      class="tab-button"
    >
      <div class="flex items-center justify-between w-full">
        <span class="font-bold text-base">Friends</span>
        <span>{{ badges()[0] }}</span>
      </div>
    </button>
    <button
      (click)="setActiveTab('requests')"
      [class]="activeTab() === 'requests' ? 'tab-button active' : 'tab-button'"
      class="tab-button"
    >
      <div class="flex items-center justify-between w-full">
        <span class="font-bold text-base">Requests</span>
        <span>{{ badges()[1] }}</span>
      </div>
    </button>
    <button
      (click)="setActiveTab('sent')"
      [class]="activeTab() === 'sent' ? 'tab-button active' : 'tab-button'"
      class="tab-button"
    >
      <div class="flex items-center justify-between w-full">
        <span class="font-bold text-base">Sent</span>
        <span>{{ badges()[2] }}</span>
      </div>
    </button>
  </div>

  <div class="p-6">
    @if (activeTab() === 'friends') {
    <div class="space-y-4">
      @if (isLoading()) {
      <div class="text-center py-8 text-gray-500">
        <p>Loading...</p>
      </div>
      } @else if (friends().length === 0) {
      <div class="text-center py-8 text-gray-500">
        <p class="text-lg font-semibold mb-2">No friends found</p>
        <p class="text-sm">Start adding friends!</p>
      </div>
      } @else { @for (friend of friends(); track friend.id) {
      <div class="friend-item">
        <div class="flex items-center justify-between gap-3">
          <span class="font-semibold text-gray-900">{{ friend.username }}</span>
          @if (actionState() !== 'deleting') {
          <button
            (click)="deleteFriend(friend.id)"
            class="text-xs text-red-500 hover:underline !p-2 !bg-transparent !text-[var(--accent)]"
          >
            Remove
          </button>
          } @else {
          <span class="text-xs text-gray-500 p-2 m-2">Removing...</span>
          }
        </div>
      </div>
      } }
    </div>
    } @if (activeTab() === 'requests') {
    <div class="space-y-4">
      @if (requests().length === 0) {
      <div class="text-center py-8 text-gray-500">
        <p class="text-lg font-semibold mb-2">No friend requests</p>
        <p class="text-sm">You currently have no pending requests</p>
      </div>
      } @else { @for (request of requests(); track request.id) {
      <div class="friend-item">
        <div class="flex items-center justify-between gap-3">
          <span class="font-semibold text-gray-900">{{ request.username }}</span>
          <div>
            @if (actionState() !== 'accepting') {
            <button
              (click)="acceptRequest(request.id)"
              class="text-xs text-red-500 hover:underline !p-2 !m-2 !bg-transparent !text-[var(--accent)]"
            >
              Accept
            </button>
            } @else {
            <span class="text-xs text-gray-500 p-2 m-2">Accepting...</span>
            } @if (actionState() !== 'rejecting') {
            <button
              (click)="rejectRequest(request.id)"
              class="text-xs text-red-500 hover:underline !p-2 !bg-transparent !text-[var(--accent)]"
            >
              Decline
            </button>
            } @else {
            <span class="text-xs text-gray-500 p-2 m-2">Declining...</span>
            }
          </div>
        </div>
      </div>
      } }
    </div>
    } @if (activeTab() === 'sent') {
    <div class="space-y-4">
      @if (sent().length === 0) {
      <div class="text-center py-8 text-gray-500">
        <p class="text-lg font-semibold mb-2">No sent requests</p>
        <p class="text-sm">You haven't sent any friend requests yet</p>
      </div>
      } @else { @for (sentRequest of sent(); track sentRequest.id) {
      <div class="friend-item">
        <div class="flex items-center gap-3">
          <span class="font-semibold text-gray-900">{{ sentRequest.username }}</span>
        </div>
      </div>
      } }
    </div>
    }
  </div>
</div>
}
