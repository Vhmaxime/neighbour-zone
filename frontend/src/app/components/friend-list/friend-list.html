<div class="w-full bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
  <div class="flex flex-col border-b border-gray-100">
    @for (tab of tabs; track tab) {
      <button
        (click)="setActiveTab(tab)"
        [class]="activeTab() === tab ? 'tab-button active' : 'tab-button'"
        class="tab-button"
      >
        <div class="flex items-center justify-between w-full">
          <span class="font-bold text-base">{{ tab }}</span>
          <span>{{ badgeCounts()[tabs.indexOf(tab)] }}</span>
        </div>
      </button>
    }
  </div>

  <div class="p-6">
    @if (isLoading()) {
      <app-loading-component />
    } @else if (error()) {
      <div class="text-center py-8">
        <div class="text-red-500 mb-4">
          <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            ></path>
          </svg>
          <p class="text-lg font-semibold">{{ error() }}</p>
        </div>
      </div>
    } @else {
      @if (activeTab() === 'Friends') {
        <div class="space-y-4">
          @if (friends()?.friends && friends()!.friends.length > 0) {
            @for (friend of friends()?.friends; track friend.id) {
              <div class="friend-item">
                <div class="flex items-center justify-between gap-3">
                  <span class="font-semibold text-gray-900">{{ friend.username }}</span>
                  @if (actionState() === 'deleting' && targetUserId() === friend.id) {
                    <span class="text-xs text-gray-500 p-2 m-2">Removing...</span>
                  } @else {
                    <button
                      (click)="deleteFriend(friend.id)"
                      class="text-xs! hover:underline! p-1! m-1! bg-transparent! text-red-500!"
                    >
                      remove
                    </button>
                  }
                </div>
              </div>
            }
          } @else {
            <div class="text-center py-8 text-gray-500">
              <p class="text-lg font-semibold mb-2">No friends yet</p>
              <p class="text-sm">Start adding friends to see them here</p>
            </div>
          }
        </div>
      } @else if (activeTab() === 'Requests') {
        <div class="space-y-4">
          @if (friends()?.requests && friends()!.requests.length > 0) {
            @for (request of friends()?.requests; track request.id) {
              <div class="friend-item">
                <div class="flex items-center justify-between gap-3">
                  <span class="font-semibold text-gray-900">{{ request.username }}</span>
                  <div>
                    @if (actionState() === 'accepting' && targetUserId() === request.id) {
                      <span class="text-xs text-gray-500 p-2 m-2">accepting...</span>
                    } @else if (actionState() === 'rejecting' && targetUserId() === request.id) {
                      <span class="text-xs text-gray-500 p-2 m-2">rejecting...</span>
                    } @else {
                      <button
                        (click)="acceptRequest(request.id)"
                        class="text-xs! hover:underline! p-1! m-1! bg-transparent! text-green-500!"
                      >
                        accept
                      </button>
                      <button
                        (click)="rejectRequest(request.id)"
                        class="text-xs! hover:underline! p-1! m-1! bg-transparent! text-red-500!"
                      >
                        reject
                      </button>
                    }
                  </div>
                </div>
              </div>
            }
          } @else {
            <div class="text-center py-8 text-gray-500">
              <p class="text-lg font-semibold mb-2">No requests</p>
            </div>
          }
        </div>
      } @else if (activeTab() === 'Sent') {
        <div class="space-y-4">
          @if (friends()?.sent && friends()!.sent.length > 0) {
            @for (request of friends()?.sent; track request.id) {
              <div class="friend-item">
                <div class="flex items-center justify-between gap-3">
                  <span class="font-semibold text-gray-900">{{ request.username }}</span>
                  @if (actionState() === 'cancelling' && targetUserId() === request.id) {
                    <span class="text-xs text-gray-500 p-2 m-2">cancelling...</span>
                  } @else {
                    <button
                      (click)="cancelSentRequest(request.id)"
                      class="text-xs! hover:underline! p-1! m-1! bg-transparent! text-red-500!"
                    >
                      cancel
                    </button>
                  }
                </div>
              </div>
            }
          } @else {
            <div class="text-center py-8 text-gray-500">
              <p class="text-lg font-semibold mb-2">No sent requests</p>
            </div>
          }
        </div>
      }
    }
  </div>
</div>
